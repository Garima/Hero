{"version":3,"file":"triggers.js","sourceRoot":"","sources":["../../.tmp/utils/triggers.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * @copyright Valor Software\r\n * @copyright Angular ng-bootstrap team\r\n */\r\nimport { ElementRef, Renderer } from '@angular/core';\r\nimport { Trigger } from './trigger.class';\r\nimport { ListenOptions } from '../component-loader/listen-options.model';\r\n\r\nconst DEFAULT_ALIASES = {\r\n  hover: ['mouseover', 'mouseout'],\r\n  focus: ['focusin', 'focusout']\r\n};\r\n\r\nexport function parseTriggers(triggers: string, aliases: any = DEFAULT_ALIASES): Trigger[] {\r\n  const trimmedTriggers = (triggers || '').trim();\r\n\r\n  if (trimmedTriggers.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const parsedTriggers = trimmedTriggers.split(/\\s+/)\r\n    .map((trigger: string) => trigger.split(':'))\r\n    .map((triggerPair: string[]) => {\r\n      let alias = aliases[triggerPair[0]] || triggerPair;\r\n      return new Trigger(alias[0], alias[1]);\r\n    });\r\n\r\n  const manualTriggers = parsedTriggers\r\n    .filter((triggerPair: Trigger) => triggerPair.isManual());\r\n\r\n  if (manualTriggers.length > 1) {\r\n    throw 'Triggers parse error: only one manual trigger is allowed';\r\n  }\r\n\r\n  if (manualTriggers.length === 1 && parsedTriggers.length > 1) {\r\n    throw 'Triggers parse error: manual trigger can\\'t be mixed with other triggers';\r\n  }\r\n\r\n  return parsedTriggers;\r\n}\r\n\r\nexport function listenToTriggers(renderer: Renderer, target: any, triggers: string,\r\n                                 showFn: Function, hideFn: Function, toggleFn: Function): Function {\r\n  const parsedTriggers = parseTriggers(triggers);\r\n  const listeners: any[] = [];\r\n\r\n  if (parsedTriggers.length === 1 && parsedTriggers[0].isManual()) {\r\n    return Function.prototype;\r\n  }\r\n\r\n  parsedTriggers.forEach((trigger: Trigger) => {\r\n    if (trigger.open === trigger.close) {\r\n      listeners.push(renderer.listen(target, trigger.open, toggleFn));\r\n      return;\r\n    }\r\n\r\n    listeners.push(\r\n      renderer.listen(target, trigger.open, showFn),\r\n      renderer.listen(target, trigger.close, hideFn));\r\n  });\r\n\r\n  return () => { listeners.forEach((unsubscribeFn: Function) => unsubscribeFn()); };\r\n}\r\n\r\nexport function listenToTriggersV2(renderer: Renderer, options: ListenOptions): Function {\r\n  const parsedTriggers = parseTriggers(options.triggers);\r\n  const target = options.target;\r\n  // do nothing\r\n  if (parsedTriggers.length === 1 && parsedTriggers[0].isManual()) {\r\n    return Function.prototype;\r\n  }\r\n\r\n  // all listeners\r\n  const listeners: any[] = [];\r\n\r\n  // lazy listeners registration\r\n  const _registerHide: Function[] = [];\r\n  const registerHide = () => {\r\n    // add hide listeners to unregister array\r\n    _registerHide.forEach((fn: Function) => listeners.push(fn()));\r\n    // register hide events only once\r\n    _registerHide.length = 0;\r\n  };\r\n\r\n  // register open\\close\\toggle listeners\r\n  parsedTriggers.forEach((trigger: Trigger) => {\r\n    const useToggle = trigger.open === trigger.close;\r\n    const showFn = useToggle ? options.toggle : options.show;\r\n\r\n    if (!useToggle) {\r\n      _registerHide.push(() => renderer.listen(target, trigger.close, options.hide));\r\n    }\r\n\r\n    listeners.push(renderer.listen(target, trigger.open, () => showFn(registerHide)));\r\n  });\r\n\r\n  return () => {\r\n    listeners.forEach((unsubscribeFn: Function) => unsubscribeFn());\r\n  };\r\n}\r\n\r\nexport function registerOutsideClick(renderer: Renderer, options: ListenOptions) {\r\n  if (!options.outsideClick) {\r\n    return Function.prototype;\r\n  }\r\n\r\n  return renderer.listenGlobal('document', 'click', (event: any) => {\r\n    if (options.target && options.target.contains(event.target)) {\r\n      return;\r\n    }\r\n    if (options.targets && options.targets.some(target => target.contains(event.target))) {\r\n      return;\r\n    }\r\n    options.hide();\r\n  });\r\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}