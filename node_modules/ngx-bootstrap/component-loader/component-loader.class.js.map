{"version":3,"file":"component-loader.class.js","sourceRoot":"","sources":["../../.tmp/component-loader/component-loader.class.ts"],"names":[],"mappings":"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","sourcesContent":["// todo: add delay support\r\n// todo: merge events onShow, onShown, etc...\r\n// todo: add global positioning configuration?\r\nimport {\r\n  ApplicationRef,\r\n  ComponentFactory,\r\n  ComponentFactoryResolver,\r\n  ComponentRef,\r\n  ElementRef, EmbeddedViewRef,\r\n  EventEmitter,\r\n  Injector,\r\n  NgZone,\r\n  Provider,\r\n  ReflectiveInjector,\r\n  Renderer,\r\n  TemplateRef,\r\n  Type,\r\n  ViewContainerRef\r\n} from '@angular/core';\r\nimport { PositioningOptions, PositioningService } from '../positioning';\r\nimport { listenToTriggersV2, registerOutsideClick } from '../utils/triggers';\r\nimport { ContentRef } from './content-ref.class';\r\nimport { ListenOptions } from './listen-options.model';\r\n\r\nexport class ComponentLoader<T> {\r\n  public onBeforeShow: EventEmitter<any> = new EventEmitter();\r\n  public onShown: EventEmitter<any> = new EventEmitter();\r\n  public onBeforeHide: EventEmitter<any> = new EventEmitter();\r\n  public onHidden: EventEmitter<any> = new EventEmitter();\r\n\r\n  public instance: T;\r\n  public _componentRef: ComponentRef<T>;\r\n  public _inlineViewRef: EmbeddedViewRef<T>;\r\n\r\n  private _providers: Provider[] = [];\r\n  private _componentFactory: ComponentFactory<T>;\r\n  private _zoneSubscription: any;\r\n  private _contentRef: ContentRef;\r\n  private _innerComponent: ComponentRef<T>;\r\n\r\n  private _unregisterListenersFn: Function;\r\n\r\n  public get isShown(): boolean {\r\n    return !!this._componentRef;\r\n  };\r\n\r\n  /**\r\n   * Placement of a component. Accepts: \"top\", \"bottom\", \"left\", \"right\"\r\n   */\r\n  private attachment: string;\r\n\r\n  /**\r\n   * A selector specifying the element the popover should be appended to.\r\n   * Currently only supports \"body\".\r\n   */\r\n  private container: string | ElementRef | any;\r\n\r\n  /**\r\n   * Specifies events that should trigger. Supports a space separated list of\r\n   * event names.\r\n   */\r\n  private triggers: string;\r\n\r\n  _listenOpts: ListenOptions = {};\r\n  _globalListener = Function.prototype;\r\n\r\n  /**\r\n   * Do not use this directly, it should be instanced via\r\n   * `ComponentLoadFactory.attach`\r\n   * @internal\r\n   */\r\n  // tslint:disable-next-line\r\n  public constructor(private _viewContainerRef: ViewContainerRef,\r\n                     private _renderer: Renderer,\r\n                     private _elementRef: ElementRef,\r\n                     private _injector: Injector,\r\n                     private _componentFactoryResolver: ComponentFactoryResolver,\r\n                     private _ngZone: NgZone,\r\n                     private _applicationRef: ApplicationRef,\r\n                     private _posService: PositioningService) {\r\n  }\r\n\r\n  public attach(compType: Type<T>): ComponentLoader<T> {\r\n    this._componentFactory = this._componentFactoryResolver\r\n      .resolveComponentFactory<T>(compType);\r\n    return this;\r\n  }\r\n\r\n  // todo: add behaviour: to target element, `body`, custom element\r\n  public to(container?: string): ComponentLoader<T> {\r\n    this.container = container || this.container;\r\n    return this;\r\n  }\r\n\r\n  public position(opts?: PositioningOptions): ComponentLoader<T> {\r\n    this.attachment = opts.attachment || this.attachment;\r\n    this._elementRef = opts.target as ElementRef || this._elementRef;\r\n    return this;\r\n  }\r\n\r\n  public provide(provider: Provider): ComponentLoader<T> {\r\n    this._providers.push(provider);\r\n    return this;\r\n  }\r\n\r\n  // todo: appendChild to element or document.querySelector(this.container)\r\n  public show(opts: { content?: string | TemplateRef<any>, context?: any, [key: string]: any } = {}): ComponentRef<T> {\r\n    this._subscribePositioning();\r\n    this._innerComponent = null;\r\n\r\n    if (!this._componentRef) {\r\n      this.onBeforeShow.emit();\r\n      this._contentRef = this._getContentRef(opts.content, opts.context);\r\n      const injector = ReflectiveInjector.resolveAndCreate(this._providers, this._injector);\r\n\r\n      this._componentRef = this._componentFactory.create(injector, this._contentRef.nodes);\r\n      this._applicationRef.attachView(this._componentRef.hostView);\r\n      // this._componentRef = this._viewContainerRef\r\n      //   .createComponent(this._componentFactory, 0, injector, this._contentRef.nodes);\r\n      this.instance = this._componentRef.instance;\r\n\r\n      Object.assign(this._componentRef.instance, opts);\r\n\r\n      if (this.container instanceof ElementRef) {\r\n        this.container.nativeElement\r\n          .appendChild(this._componentRef.location.nativeElement);\r\n      }\r\n\r\n      if (this.container === 'body' && typeof document !== 'undefined') {\r\n        document.querySelector(this.container as string)\r\n          .appendChild(this._componentRef.location.nativeElement);\r\n      }\r\n\r\n      if (!this.container && this._elementRef && this._elementRef.nativeElement.parentElement) {\r\n        this._elementRef.nativeElement.parentElement\r\n          .appendChild(this._componentRef.location.nativeElement);\r\n      }\r\n\r\n      // we need to manually invoke change detection since events registered\r\n      // via\r\n      // Renderer::listen() are not picked up by change detection with the\r\n      // OnPush strategy\r\n      if (this._contentRef.componentRef) {\r\n        this._innerComponent = this._contentRef.componentRef.instance;\r\n        this._contentRef.componentRef.changeDetectorRef.markForCheck();\r\n        this._contentRef.componentRef.changeDetectorRef.detectChanges();\r\n      }\r\n      this._componentRef.changeDetectorRef.markForCheck();\r\n      this._componentRef.changeDetectorRef.detectChanges();\r\n      this.onShown.emit(this._componentRef.instance);\r\n    }\r\n\r\n    this._registerOutsideClick();\r\n\r\n    return this._componentRef;\r\n  }\r\n\r\n  public hide(): ComponentLoader<T> {\r\n    if (!this._componentRef) {\r\n      return this;\r\n    }\r\n\r\n    this.onBeforeHide.emit(this._componentRef.instance);\r\n\r\n    const componentEl = this._componentRef.location.nativeElement;\r\n    componentEl.parentNode.removeChild(componentEl);\r\n    if (this._contentRef.componentRef) {\r\n      this._contentRef.componentRef.destroy();\r\n    }\r\n    this._componentRef.destroy();\r\n    if (this._viewContainerRef && this._contentRef.viewRef) {\r\n      this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._contentRef.viewRef));\r\n    }\r\n    // this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._componentRef.hostView));\r\n    //\r\n    // if (this._contentRef.viewRef && this._viewContainerRef.indexOf(this._contentRef.viewRef) !== -1) {\r\n    //   this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._contentRef.viewRef));\r\n    // }\r\n\r\n    this._contentRef = null;\r\n    this._componentRef = null;\r\n    this._removeGlobalListener();\r\n\r\n    this.onHidden.emit();\r\n\r\n    return this;\r\n  }\r\n\r\n  public toggle(): void {\r\n    if (this.isShown) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    this.show();\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (this.isShown) {\r\n      this.hide();\r\n    }\r\n\r\n    this._unsubscribePositioning();\r\n\r\n    if (this._unregisterListenersFn) {\r\n      this._unregisterListenersFn();\r\n    }\r\n  }\r\n\r\n  public listen(listenOpts: ListenOptions): ComponentLoader<T> {\r\n    this.triggers = listenOpts.triggers || this.triggers;\r\n    this._listenOpts.outsideClick = listenOpts.outsideClick;\r\n    listenOpts.target = listenOpts.target || this._elementRef.nativeElement;\r\n\r\n    const hide = this._listenOpts.hide = () => listenOpts.hide ? listenOpts.hide() : this.hide();\r\n    const show = this._listenOpts.show = (registerHide: Function) => {\r\n      listenOpts.show ? listenOpts.show(registerHide) : this.show(registerHide);\r\n      registerHide();\r\n    };\r\n\r\n    const toggle = (registerHide: Function) => {\r\n      this.isShown ? hide() : show(registerHide);\r\n    };\r\n\r\n    this._unregisterListenersFn = listenToTriggersV2(this._renderer, {\r\n      target: listenOpts.target,\r\n      triggers: listenOpts.triggers,\r\n      show, hide, toggle\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  _removeGlobalListener() {\r\n    if (this._globalListener) {\r\n      this._globalListener();\r\n      this._globalListener = null;\r\n    }\r\n  }\r\n\r\n  attachInline(vRef: ViewContainerRef, template: TemplateRef<any>): ComponentLoader<T> {\r\n    this._inlineViewRef = vRef.createEmbeddedView(template);\r\n    return this;\r\n  }\r\n\r\n  _registerOutsideClick(): void {\r\n    if (!this._componentRef || !this._componentRef.location) {\r\n      return;\r\n    }\r\n    // why: should run after first event bubble\r\n    if (this._listenOpts.outsideClick) {\r\n      const target = this._componentRef.location.nativeElement;\r\n      setTimeout(() => {\r\n        this._globalListener = registerOutsideClick(this._renderer, {\r\n          targets: [target, this._elementRef.nativeElement],\r\n          outsideClick: this._listenOpts.outsideClick,\r\n          hide: () => this._listenOpts.hide()\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  public getInnerComponent(): ComponentRef<T> {\r\n    return this._innerComponent;\r\n  }\r\n\r\n  private _subscribePositioning(): void {\r\n    if (this._zoneSubscription || !this.attachment) {\r\n      return;\r\n    }\r\n\r\n    this._zoneSubscription = this._ngZone\r\n      .onStable.subscribe(() => {\r\n        if (!this._componentRef) {\r\n          return;\r\n        }\r\n        this._posService.position({\r\n          element: this._componentRef.location,\r\n          target: this._elementRef,\r\n          attachment: this.attachment,\r\n          appendToBody: this.container === 'body'\r\n        });\r\n      });\r\n  }\r\n\r\n  private _unsubscribePositioning(): void {\r\n    if (!this._zoneSubscription) {\r\n      return;\r\n    }\r\n    this._zoneSubscription.unsubscribe();\r\n    this._zoneSubscription = null;\r\n  }\r\n\r\n  private _getContentRef(content: string | TemplateRef<any> | any, context?: any): ContentRef {\r\n    if (!content) {\r\n      return new ContentRef([]);\r\n    }\r\n\r\n    if (content instanceof TemplateRef) {\r\n      if (this._viewContainerRef) {\r\n        const viewRef = this._viewContainerRef.createEmbeddedView<TemplateRef<T>>(content, context);\r\n        viewRef.markForCheck();\r\n        return new ContentRef([viewRef.rootNodes], viewRef);\r\n      }\r\n      const viewRef = content.createEmbeddedView({});\r\n      this._applicationRef.attachView(viewRef);\r\n      return new ContentRef([viewRef.rootNodes], viewRef);\r\n    }\r\n\r\n    if (typeof content === 'function') {\r\n      const contentCmptFactory = this._componentFactoryResolver.resolveComponentFactory(content);\r\n      const modalContentInjector = ReflectiveInjector.resolveAndCreate([...this._providers, content], this._injector);\r\n      const componentRef = contentCmptFactory.create(modalContentInjector);\r\n      this._applicationRef.attachView(componentRef.hostView);\r\n      return new ContentRef([[componentRef.location.nativeElement]], componentRef.hostView, componentRef);\r\n    }\r\n    return new ContentRef([[this._renderer.createText(null, `${content}`)]]);\r\n  }\r\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}